
  <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>SkillBridge - Tiram AI</title>
      <style>
          :root {
              --primary-color: #374151;
              --primary-hover: #1f2937;
              --primary-light: #6b7280;
              --secondary-color: #0ea5e9;
              --success-color: #10b981;
              --gray-50: #f9fafb;
              --gray-100: #f3f4f6;
              --gray-200: #e5e7eb;
              --gray-300: #d1d5db;
              --gray-400: #9ca3af;
              --gray-500: #6b7280;
              --gray-600: #4b5563;
              --gray-700: #374151;
              --gray-800: #1f2937;
              --gray-900: #111827;
              --white: #ffffff;
              --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
              --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
              --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
              --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
          }
  
          * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
          }
  
          body {
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
              background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
              min-height: 100vh;
              color: var(--gray-900);
          }
  
          .container {
              max-width: 1200px;
              margin: 0 auto;
              padding: 2rem;
          }
  
          .header {
              text-align: center;
              margin-bottom: 3rem;
          }
  
          .header h1 {
              font-size: 2.5rem;
              font-weight: 700;
              background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
              -webkit-background-clip: text;
              -webkit-text-fill-color: transparent;
              background-clip: text;
              margin-bottom: 1rem;
          }
  
          .header p {
              font-size: 1.1rem;
              color: var(--gray-600);
              max-width: 600px;
              margin: 0 auto;
          }
  
          .prototype-badge {
              display: inline-flex;
              align-items: center;
              gap: 0.5rem;
              background: rgba(240, 74, 0, 0.1);
              color: var(--primary-color);
              padding: 0.5rem 1rem;
              border-radius: 50px;
              font-size: 0.9rem;
              font-weight: 600;
              margin-bottom: 2rem;
          }
  
          .apps-grid {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
              gap: 2rem;
              margin-top: 2rem;
              max-width: 1400px;
              margin-left: auto;
              margin-right: auto;
          }
  
          .app-card {
              background: var(--white);
              border-radius: 20px;
              padding: 0;
              box-shadow: var(--shadow-md);
              transition: all 0.3s ease;
              border: 2px solid transparent;
              overflow: hidden;
              position: relative;
          }
  
          .app-card:hover {
              transform: translateY(-8px);
              box-shadow: var(--shadow-xl);
              border-color: var(--primary-color);
          }
  
          .app-content {
              padding: 3rem 1.5rem 1.5rem;
              display: flex;
              flex-direction: column;
              min-height: 200px;
          }
  
          .app-info {
              flex: 1;
          }
  
          .app-title-container {
              display: flex;
              align-items: center;
              gap: 0.75rem;
              margin-bottom: 0.75rem;
          }
  
          .app-title {
              font-size: 1.4rem;
              font-weight: 700;
              color: var(--gray-900);
              line-height: 1.3;
              margin: 0;
              flex: 1;
          }
  
          .launch-icon {
              background: var(--primary-color);
              color: var(--white);
              border: none;
              border-radius: 8px;
              width: 32px;
              height: 32px;
              display: flex;
              align-items: center;
              justify-content: center;
              cursor: pointer;
              transition: all 0.2s ease;
              box-shadow: var(--shadow-sm);
              flex-shrink: 0;
          }
  
          .launch-icon:hover {
              background: var(--primary-hover);
              transform: scale(1.1);
              box-shadow: var(--shadow-md);
          }
  
          .app-description {
              color: var(--gray-600);
              font-size: 0.95rem;
              line-height: 1.6;
              margin-bottom: 1rem;
              display: -webkit-box;
              -webkit-line-clamp: 3;
              -webkit-box-orient: vertical;
              overflow: hidden;
              text-overflow: ellipsis;
              max-height: 4.8em;
          }
  
          .app-persona {
              display: inline-flex;
              align-items: center;
              gap: 0.5rem;
              background: linear-gradient(135deg, var(--gray-100), var(--gray-50));
              color: var(--gray-700);
              padding: 0.5rem 1rem;
              border-radius: 25px;
              font-size: 0.85rem;
              font-weight: 600;
              border: 1px solid var(--gray-200);
          }
  
  
  
          .footer {
              text-align: center;
              margin-top: 4rem;
              padding-top: 2rem;
              border-top: 1px solid var(--gray-200);
          }
  
          .footer p {
              color: var(--gray-500);
              font-size: 0.9rem;
          }
  
          .feedback-button {
              position: fixed;
              bottom: 2rem;
              right: 2rem;
              background: var(--primary-color);
              color: var(--white);
              border: none;
              border-radius: 50px;
              padding: 1rem 2rem;
              font-weight: 600;
              cursor: pointer;
              box-shadow: var(--shadow-lg);
              transition: all 0.3s ease;
          }
  
          .feedback-button:hover {
              background: var(--primary-hover);
              transform: scale(1.05);
          }
  
          @media (max-width: 768px) {
              .container {
                  padding: 1rem;
              }
  
              .header h1 {
                  font-size: 2rem;
              }
  
              .apps-grid {
                  grid-template-columns: 1fr;
                  gap: 1rem;
              }
  
              .app-content {
                  padding: 2.5rem 1rem 1rem;
                  min-height: 180px;
              }
  
              .app-number {
                  top: 1rem;
                  left: 1rem;
                  width: 24px;
                  height: 24px;
                  font-size: 0.75rem;
              }
  
              .app-title {
                  font-size: 1.2rem;
              }
  
              .app-description {
                  font-size: 0.9rem;
                  margin-bottom: 0.75rem;
              }
  
              .launch-icon {
                  width: 28px;
                  height: 28px;
              }
  
              .feedback-button {
                  bottom: 1rem;
                  right: 1rem;
                  padding: 0.75rem 1.5rem;
              }
          }
          /* Auth Loading Overlay */
          #auth-loading-overlay {
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(255, 255, 255, 0.95);
              backdrop-filter: blur(10px);
              z-index: 9999;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              gap: 1.5rem;
              transition: opacity 0.3s ease;
          }

          #auth-loading-overlay.hidden {
              opacity: 0;
              pointer-events: none;
          }

          .loader-spinner {
              width: 60px;
              height: 60px;
              border: 4px solid var(--gray-200);
              border-top: 4px solid var(--primary-color);
              border-radius: 50%;
              animation: spin 1s linear infinite;
          }

          .loader-text {
              font-size: 1.1rem;
              color: var(--gray-700);
              font-weight: 500;
          }

          @keyframes spin {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
          }
      </style>
  </head>
  <body>
      <!-- Auth Loading Overlay -->
      <div id="auth-loading-overlay">
          <div class="loader-spinner"></div>
          <div class="loader-text">Identifying your role and applications...</div>
      </div>

      <div class="container">
          <div class="header">
              <div style="position: absolute; top: 2rem; right: 2rem;">
                  <button id="signout-button" style="padding: 0.75rem 1.5rem; border: none; border-radius: 8px; background: var(--primary-color); color: var(--white); font-weight: 600; cursor: pointer; transition: all 0.2s ease; box-shadow: var(--shadow-sm);">
                      Sign Out
                  </button>
              </div>
              <h1>SkillBridge</h1>
              <p>Choose an application to explore. Each app is designed for specific user personas and business workflows.</p>
              <p id="user-greeting" style="margin-top: 0.5rem; color: var(--gray-700); font-weight: 600; display: none;"></p>
          </div>
  
          <div class="apps-grid">
              
          <div class="app-card" data-app-type="system_administrator" style="display: none;">
            <div class="app-content">
              <div class="app-info">
                <div class="app-title-container">
                  <h3 class="app-title">SkillBridge Admin Portal</h3>
                  <button class="launch-icon" onclick="navigateToApp('system_administrator', 'dashboard.html')" title="Launch App">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                      <polyline points="15,3 21,3 21,9"/>
                      <line x1="10" y1="14" x2="21" y2="3"/>
                    </svg>
                  </button>
                </div>
                <p class="app-description">Comprehensive web-based administrative platform for System Admins to manage organization-wide skill frameworks, employee hierarchies, assessment cycles, training sessions, and dispute resolution. Web platform is optimal for this persona due to the need for extensive CRUD operations, complex data visualization (heatmaps, analytics dashboards), multi-tab workflows for managing departments/skills/benchmarks with version control, and advanced reporting capabilities that require large screen real estate and keyboard-intensive data entry across multiple interconnected modules.</p>
                <span class="app-persona">ðŸ‘¤ System Administrator</span>
              </div>
            </div>
          </div>
        
          <div class="app-card" data-app-type="team_lead" style="display: none;">
            <div class="app-content">
              <div class="app-info">
                <div class="app-title-container">
                  <h3 class="app-title">SkillBridge Team Management Portal</h3>
                  <button class="launch-icon" onclick="navigateToApp('team_lead', 'team_dashboard.html')" title="Launch App">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                      <polyline points="15,3 21,3 21,9"/>
                      <line x1="10" y1="14" x2="21" y2="3"/>
                    </svg>
                  </button>
                </div>
                <p class="app-description">Web application for Team Leads to perform skill mapping for direct reports, conduct detailed skill assessments with mandatory comments, and access team-level analytics dashboards. Web platform is optimal for this persona because assessment workflows require side-by-side comparison of benchmark scores while rating multiple skills per employee, viewing historical growth trends with data visualizations, and managing assessment cycles that benefit from larger displays for comprehensive team skill gap overviews and efficient bulk assessment completion.</p>
                <span class="app-persona">ðŸ‘¤ Team Lead</span>
              </div>
            </div>
          </div>
        
          <div class="app-card" data-app-type="employee" style="display: none;">
            <div class="app-content">
              <div class="app-info">
                <div class="app-title-container">
                  <h3 class="app-title">SkillBridge Employee Portal</h3>
                  <button class="launch-icon" onclick="navigateToApp('employee', 'employee_dashboard.html')" title="Launch App">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                      <polyline points="15,3 21,3 21,9"/>
                      <line x1="10" y1="14" x2="21" y2="3"/>
                    </svg>
                  </button>
                </div>
                <p class="app-description">Web application for Employees to view their skill profiles, track growth timelines with benchmark comparisons, access assigned training sessions, submit post-training feedback, and manage dispute workflows including viewing dispute status and responding to admin resolutions. Web platform is optimal for this persona to provide detailed skill gap visualizations (Red/Amber/Green), comprehensive growth timeline charts showing score progression against versioned benchmarks, and structured dispute submission forms with multi-skill selection and detailed reasoning that benefit from desktop interaction patterns.</p>
                <span class="app-persona">ðŸ‘¤ Employee</span>
              </div>
            </div>
          </div>
        
          </div>
  
          <div class="footer">
              <p>Built with Tiram AI</p>
          </div>
      </div>
  
      <script type="module">
          // Import authentication utilities
          import { setupAutoAuthProtection, getUserData, getUserAccessibleApps, signOutUser } from './lib/auth/index.js';
          import { showLoader, hideLoader } from './scripts/loader.js';
          import { showSuccess, showError, showInfo } from './lib/toast/toast.js';
          import { auth } from './scripts/firebase.js';
          import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js';

          // Expose functions globally for inline onclick handlers
          window.navigateToApp = function(appFolderName, firstPage) {
              const appUrl = `./apps/${appFolderName}/${firstPage}`;
              window.open(appUrl, '_blank');
          };
  
          window.openFeedback = function() {
              // This would integrate with your feedback system
              alert('Feedback system integration - to be implemented');
          };

          // Display accessible app cards based on user role
          async function displayAccessibleApps(user) {
              try {
                  // Keep auth loading overlay visible
                  const authOverlay = document.getElementById('auth-loading-overlay');
                  
                  showLoader('Loading your applications...');
                  
                  // Fetch user data from Firestore
                  const userData = await getUserData(user.uid, user.email);
                  
                  if (!userData) {
                      hideLoader();
                      if (authOverlay) authOverlay.classList.add('hidden');
                      showError('User data not found. Please contact administrator.');
                      setTimeout(() => signOutUser(), 2000);
                      return;
                  }
                  
                  // Display user greeting
                  const greetingElement = document.getElementById('user-greeting');
                  if (greetingElement) {
                      greetingElement.textContent = `Welcome, ${userData.firstName} ${userData.lastName}!`;
                      greetingElement.style.display = 'block';
                  }
                  
                  // Get accessible apps based on user role
                  const accessibleApps = await getUserAccessibleApps(userData);
                  
                  console.log('User role:', userData.role);
                  console.log('Accessible apps:', accessibleApps);
                  
                  // If user has only one app, navigate directly to it
                  if (accessibleApps.length === 1) {
                      const singleApp = accessibleApps[0];
                      hideLoader();
                      
                      // Map app types to their dashboard pages
                      const appRoutes = {
                          'system_administrator': 'apps/system_administrator/dashboard.html',
                          'team_lead': 'apps/team_lead/team_dashboard.html',
                          'employee': 'apps/employee/employee_dashboard.html'
                      };
                      
                      const appUrl = appRoutes[singleApp];
                      if (appUrl) {
                          console.log('[Navigator] Redirecting to single accessible app:', singleApp);
                          // Keep overlay visible during redirect
                          window.location.href = appUrl;
                          return;
                      }
                  }
                  
                  // Show only accessible app cards
                  const allAppCards = document.querySelectorAll('.app-card');
                  allAppCards.forEach(card => {
                      const appType = card.getAttribute('data-app-type');
                      if (accessibleApps.includes(appType)) {
                          card.style.display = 'block';
                      } else {
                          card.style.display = 'none';
                      }
                  });
                  
                  hideLoader();
                  
                  // Hide auth loading overlay after everything is ready
                  if (authOverlay) {
                      authOverlay.classList.add('hidden');
                  }
                  
                  // Show info about accessible apps
                  showInfo(`You have access to ${accessibleApps.length} applications.`);
                  
              } catch (error) {
                  hideLoader();
                  const authOverlay = document.getElementById('auth-loading-overlay');
                  if (authOverlay) authOverlay.classList.add('hidden');
                  console.error('Error loading applications:', error);
                  showError('Failed to load applications. Please refresh the page.');
              }
          }
  
          // Initialize navigator with authentication
          document.addEventListener('DOMContentLoaded', async function() {
              console.log('Navigator page loaded - initializing authentication...');
              
              // Set up authentication protection
              const unsubscribe = setupAutoAuthProtection();
              
              // Listen for auth state changes
              onAuthStateChanged(auth, async (user) => {
                  if (user) {
                      // User is signed in - show auth loading overlay
                      const authOverlay = document.getElementById('auth-loading-overlay');
                      if (authOverlay) {
                          authOverlay.classList.remove('hidden');
                      }
                      
                      // Display apps (will hide overlay when done)
                      await displayAccessibleApps(user);
                  } else {
                      // No user - hide overlay if shown
                      const authOverlay = document.getElementById('auth-loading-overlay');
                      if (authOverlay) {
                          authOverlay.classList.add('hidden');
                      }
                  }
                  // If no user, setupAutoAuthProtection will handle redirect
              });
              
              // Sign out button handler
              const signOutButton = document.getElementById('signout-button');
              if (signOutButton) {
                  signOutButton.addEventListener('click', async () => {
                      showLoader('Signing out...');
                      await signOutUser();
                  });
                  
                  // Hover effect
                  signOutButton.addEventListener('mouseenter', () => {
                      signOutButton.style.background = 'var(--primary-hover)';
                      signOutButton.style.transform = 'translateY(-2px)';
                      signOutButton.style.boxShadow = 'var(--shadow-md)';
                  });
                  signOutButton.addEventListener('mouseleave', () => {
                      signOutButton.style.background = 'var(--primary-color)';
                      signOutButton.style.transform = 'translateY(0)';
                      signOutButton.style.boxShadow = 'var(--shadow-sm)';
                  });
              }
              
              // Initialize feedback module for navigator
              initialiseFeedback();
              
              // Note: Confirmation modal will be shown after app loading completes
              // See displayAccessibleApps function
          });
  
          const initialiseFeedback = () => {
              const style = document.createElement("link");
              style.rel = "stylesheet";
              style.href = "https://feedback-lib.tiram.app/tiramai-feedback-lib.css";
              document.body.appendChild(style);

              const script = document.createElement("script");
              script.src = "https://feedback-lib.tiram.app/tiramai-feedback-lib.min.js";

              script.onload = async function () {
                new window.TiramaiFeedbackLib({
                  // Required
                  apiKey: "eyJidXNpbmVzc0lkZWFJZCI6IjFjOWY5MTI4LTgyODAtNGI0Mi1hOWFjLWQ4MmUzNWVkODYxMyIsImNyZWF0ZWRBdCI6MTc2NzAwNzY3NDE5NCwiY3JlYXRlZEJ5IjoiY29kZWdlbmVzaXMifQ==",

                  // Context
                  businessIdeaId: "1c9f9128-8280-4b42-a9ac-d82e35ed8613",
                  projectName: "SkillBridge",
                  personaRole: "SkillBridge",
                  email: "N/A",
                  environment: "development"
                });
              };
              document.body.appendChild(script);
            };

            const initialiseHelpbot = async () => {
              try {
                const versionResponse = await fetch('https://tiramai-helpbot-lib.vercel.app/version.json?t=' + Date.now());
                const versionData = await versionResponse.json();
                
                // Inject CSS with version
                const style = document.createElement('link');
                style.rel = 'stylesheet';
                style.href = versionData.cdn.css;
                document.body.appendChild(style);

                // Inject JS with version
                const script = document.createElement('script');
                script.src = versionData.cdn.js;

                script.onload = function () {
                  new window.TiramaiHelpBotLib({
                    ideaId: "1c9f9128-8280-4b42-a9ac-d82e35ed8613",
                    apiKey: "eyJidXNpbmVzc0lkZWFJZCI6IjFjOWY5MTI4LTgyODAtNGI0Mi1hOWFjLWQ4MmUzNWVkODYxMyIsImNyZWF0ZWRBdCI6MTc2NzAwNzY3NDE5NCwiY3JlYXRlZEJ5IjoiY29kZWdlbmVzaXMifQ==",
                    shouldShowMode: false,
                    defaultVersion: 'v1'
                  });
                  console.log('[Stage1] Helpbot v' + versionData.version + ' initialized');
                };

                script.onerror = function () {
                  console.error('[Stage1] Failed to load Helpbot library');
                };

                document.body.appendChild(script);
              } catch (error) {
                console.error('[Stage1] Helpbot initialization error:', error);
              }
            };
            
            
            /**
 * Initialize the refiner module
 */
const initialiseRefiner = () => {
  console.log('[Main] Initializing Refiner');
  // Add CDN for refiner
  const style = document.createElement('link');
  style.rel = 'stylesheet';
  style.href = 'https://refiner-lib.tiram.app/tiramai-refiner-lib.css';
  document.body.appendChild(style);

  const script = document.createElement('script');
  script.src = 'https://refiner-lib.tiram.app/tiramai-refiner-lib.min.js';

  // Initialize the refiner lib on script load
  script.onload = function () {
    // Initialize the Tiramai Refiner
    new window.RefinerLib({
      apiUrl:
        "https://code-genesis-dev.azurewebsites.net/refiner/refine-page?env=dev",
      saveApiUrl:
        "https://code-genesis-dev.azurewebsites.net/refiner/apply-changes-to-deployments?env=dev",
      suggestionsApiUrl:
        "https://code-genesis-dev.azurewebsites.net/refiner/get-element-suggestions?env=dev",
      fabPosition: "bottom-right",
      highlightColor: "#f04a01",
      createdBy: "prototype_email@zpqv.com",
      personaRole: "SkillBridge",
      appTitle: "SkillBridge",
      appType: "business",
      businessIdeaId: "1c9f9128-8280-4b42-a9ac-d82e35ed8613",
      environment: "development",
    });
  };

  document.body.appendChild(script);
};

      </script>
  </body>
  </html>