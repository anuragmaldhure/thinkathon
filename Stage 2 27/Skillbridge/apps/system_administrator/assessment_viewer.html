<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SkillBridge Competency Management Platform</title>

    <!-- Required: Main JS Script -->
    <script type="module" src="scripts/main.js" data-tiramai="web-gen"></script>

    <!-- Required: TailwindCSS -->
    <script src="./lib/tailwindcss/tailwindcss.js" fetchpriority="high" data-tiramai="web-gen"></script>

    <!-- Required: Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest" data-tiramai="web-gen"></script>

    <!-- Required: Favicon -->
    <link rel="icon" href="assets/imgs/logo.ico" type="image/x-icon" data-tiramai="web-gen"/>

    <!-- ECharts Support (for charts/graphs) -->
    <script defer src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js" data-tiramai="web-gen"></script>

    <!-- Markdown Support (for content rendering) -->
    <script defer src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" data-tiramai="web-gen"></script>

    <!-- Tailwind Configuration -->
    <script data-tiramai="web-gen">
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e293b',
                        secondary: '#475569',
                        accent: '#2563eb',
                        gold: '#CBA35C',
                        success: '#16A34A',
                        warning: '#D97706',
                        error: '#DC2626',
                        info: '#0EA5E9',
                        neutral: {
                            50: '#F8FAFC',
                            100: '#F1F5F9',
                            200: '#E2E8F0',
                            400: '#94A3B8',
                            700: '#334155',
                            900: '#0F172A',
                        }
                    },
                    fontFamily: {
                        sans: ['IBM Plex Sans', '-apple-system', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                        mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', 'monospace']
                    },
                    boxShadow: {
                        sm: '0 1px 2px rgba(15,23,42,0.06)',
                        DEFAULT: '0 2px 8px rgba(15,23,42,0.08)',
                        lg: '0 8px 24px rgba(15,23,42,0.12)',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-neutral-50 min-h-screen text-neutral-700 font-sans">
    <!-- Top Navigation -->
    <header class="fixed top-0 left-0 right-0 bg-white border-b border-neutral-200 flex items-center justify-between px-6 py-4 z-30 h-16">
        <div class="flex items-center gap-4">
            <button id="mobile-menu-btn" class="md:hidden p-2 hover:bg-neutral-100 rounded-md transition-colors duration-150">
                <i data-lucide="menu" class="w-6 h-6 text-secondary"></i>
            </button>
            <div class="flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 400 400" fill="none" class="h-8 w-8">
                    <rect x="100" y="100" width="200" height="200" rx="16" stroke="#1e293b" stroke-width="16" fill="none"/>
                    <path d="M150 250V170c0-11 9-20 20-20h60c11 0 20 9 20 20v80" stroke="#2563eb" stroke-width="14" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                    <circle cx="200" cy="170" r="18" stroke="#1e293b" stroke-width="12" fill="none"/>
                    <path d="M150 250h100m-60-30h20" stroke="#2563eb" stroke-width="12" stroke-linecap="round" fill="none"/>
                    <path d="M170 220v0" stroke="#1e293b" stroke-width="12" stroke-linecap="round"/>
                    <path d="M230 220v0" stroke="#1e293b" stroke-width="12" stroke-linecap="round"/>
                </svg>
                <span class="text-xl font-semibold text-primary">SkillBridge Competency Management Platform</span>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <!-- User Profile Dropdown -->
            <div class="relative">
                <button id="user-profile-btn" class="flex items-center gap-3 p-2 hover:bg-neutral-100 rounded-md transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2">
                    <div class="flex flex-col items-end">
                        <span id="user-name" class="text-sm font-medium text-neutral-700">Loading...</span>
                        <span id="user-role" class="text-xs text-neutral-400">System Admin</span>
                    </div>
                    <div class="w-8 h-8 bg-accent rounded-full flex items-center justify-center">
                        <i data-lucide="user" class="w-4 h-4 text-white"></i>
                    </div>
                </button>
                <!-- Dropdown Menu -->
                <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-neutral-200 z-40">
                    <div class="py-2">
                        <button id="sign-out-btn" class="w-full px-4 py-2 text-left text-sm text-neutral-700 hover:bg-neutral-50 flex items-center gap-2">
                            <i data-lucide="log-out" class="w-4 h-4"></i>
                            Sign Out
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex pt-16">
        <!-- Side Navigation -->
        <aside id="sidebar" class="w-64 bg-white border-r border-neutral-200 h-[calc(100vh-4rem)] sticky top-16 overflow-y-auto hidden md:block">
            <nav class="p-4 space-y-1">
                <!-- Analytics Hub -->
                <a href="analytics_hub.html" data-page="analytics_hub" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                    <span>Analytics Hub</span>
                </a>

                <!-- Organization Management Section -->
                <div class="pt-4">
                    <h3 class="px-3 text-xs font-semibold text-secondary uppercase tracking-wide mb-2">Organization</h3>
                    <a href="org_configuration.html" data-page="org_configuration" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                        <i data-lucide="building-2" class="w-5 h-5"></i>
                        <span>Org Configuration</span>
                    </a>
                    <a href="org_settings_versioned.html" data-page="org_settings_versioned" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                        <i data-lucide="history" class="w-5 h-5"></i>
                        <span>Org Settings</span>
                    </a>
                </div>

                <!-- Core Management Section -->
                <div class="pt-4">
                    <h3 class="px-3 text-xs font-semibold text-secondary uppercase tracking-wide mb-2">Core Management</h3>
                    <a href="skill_framework.html" data-page="skill_framework" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                        <i data-lucide="book-open" class="w-5 h-5"></i>
                        <span>Skill Framework</span>
                    </a>
                    <a href="employees_hierarchy.html" data-page="employees_hierarchy" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                        <i data-lucide="users" class="w-5 h-5"></i>
                        <span>Employees & Hierarchy</span>
                    </a>
                    <a href="training_management.html" data-page="training_management" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                        <i data-lucide="calendar" class="w-5 h-5"></i>
                        <span>Training Management</span>
                    </a>
                </div>

                <!-- Operations Section -->
                <div class="pt-4">
                    <h3 class="px-3 text-xs font-semibold text-secondary uppercase tracking-wide mb-2">Operations</h3>
                    <a href="disputes_center.html" data-page="disputes_center" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                        <i data-lucide="gavel" class="w-5 h-5"></i>
                        <span>Disputes Center</span>
                    </a>
                    <a href="assessment_viewer.html" data-page="assessment_viewer" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                        <i data-lucide="file-text" class="w-5 h-5"></i>
                        <span>Assessment Viewer</span>
                    </a>
                    <a href="audit_log_viewer.html" data-page="audit_log_viewer" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                        <i data-lucide="file-search" class="w-5 h-5"></i>
                        <span>Audit Log Viewer</span>
                    </a>
                </div>
            </nav>

            <!-- Footer -->
            <div class="absolute bottom-6 w-full text-center text-xs text-neutral-400 bg-white px-4">
                Made with ❤️ by TiramAi
            </div>
        </aside>

        <!-- Mobile Navigation Overlay -->
        <div id="mobile-nav-overlay" class="hidden fixed inset-0 z-40 md:hidden">
            <div class="fixed inset-0 bg-neutral-900 bg-opacity-50" id="mobile-nav-backdrop"></div>
            <aside class="fixed left-0 top-16 h-[calc(100vh-4rem)] w-64 bg-white border-r border-neutral-200 overflow-y-auto">
                <nav class="p-4 space-y-1">
                    <!-- Same navigation structure as desktop -->
                    <a href="analytics_hub.html" data-page="analytics_hub" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                        <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                        <span>Analytics Hub</span>
                    </a>
                    
                    <div class="pt-4">
                        <h3 class="px-3 text-xs font-semibold text-secondary uppercase tracking-wide mb-2">Organization</h3>
                        <a href="org_configuration.html" data-page="org_configuration" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                            <i data-lucide="building-2" class="w-5 h-5"></i>
                            <span>Org Configuration</span>
                        </a>
                        <a href="org_settings_versioned.html" data-page="org_settings_versioned" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                            <i data-lucide="history" class="w-5 h-5"></i>
                            <span>Org Settings</span>
                        </a>
                    </div>

                    <div class="pt-4">
                        <h3 class="px-3 text-xs font-semibold text-secondary uppercase tracking-wide mb-2">Core Management</h3>
                        <a href="skill_framework.html" data-page="skill_framework" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                            <i data-lucide="book-open" class="w-5 h-5"></i>
                            <span>Skill Framework</span>
                        </a>
                        <a href="employees_hierarchy.html" data-page="employees_hierarchy" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                            <i data-lucide="users" class="w-5 h-5"></i>
                            <span>Employees & Hierarchy</span>
                        </a>
                        <a href="training_management.html" data-page="training_management" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                            <i data-lucide="calendar" class="w-5 h-5"></i>
                            <span>Training Management</span>
                        </a>
                    </div>

                    <div class="pt-4">
                        <h3 class="px-3 text-xs font-semibold text-secondary uppercase tracking-wide mb-2">Operations</h3>
                        <a href="disputes_center.html" data-page="disputes_center" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                            <i data-lucide="gavel" class="w-5 h-5"></i>
                            <span>Disputes Center</span>
                        </a>
                        <a href="assessment_viewer.html" data-page="assessment_viewer" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                            <i data-lucide="file-text" class="w-5 h-5"></i>
                            <span>Assessment Viewer</span>
                        </a>
                        <a href="audit_log_viewer.html" data-page="audit_log_viewer" class="nav-item flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 transition-colors duration-150 text-neutral-700">
                            <i data-lucide="file-search" class="w-5 h-5"></i>
                            <span>Audit Log Viewer</span>
                        </a>
                    </div>
                </nav>
            </aside>
        </div>

        <!-- Main Content -->
        <main id="pageContent" class="flex-1 p-6 overflow-y-auto max-w-[1440px] mx-auto">
            
<!-- Assessment Viewer Page -->
<div class="container mx-auto max-w-[1440px]">
  <!-- Page Header -->
  <div class="mb-6">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <div>
        <h1 class="text-[clamp(1.5rem,2.5vw,2rem)] leading-10 font-bold text-primary mb-2">Assessment Viewer</h1>
        <p class="text-sm text-secondary">Read-only viewer to inspect any submitted assessment with its benchmark context.</p>
      </div>
      <div class="flex items-center gap-2">
        <button id="btn-refresh" class="inline-flex items-center gap-2 text-sm text-secondary hover:text-primary transition-colors duration-150" aria-label="Refresh assessments">
          <i data-lucide="refresh-cw" class="w-4 h-4"></i>
          Refresh
        </button>
        <button id="btn-back" class="inline-flex items-center gap-2 bg-white text-primary border border-neutral-200 rounded-md px-4 py-2 hover:bg-neutral-50 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 transition-colors duration-150">
          <i data-lucide="arrow-left" class="w-4 h-4"></i>
          Back
        </button>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-12 gap-6">
    <!-- Left Pane: Filters -->
    <aside class="col-span-12 lg:col-span-3">
      <div class="bg-white rounded-md shadow-sm border border-neutral-200 p-4">
        <h2 class="text-lg leading-7 font-semibold text-primary mb-4">Filters</h2>
        
        <!-- Search -->
        <div class="mb-4">
          <label class="block text-xs text-secondary mb-1">Search</label>
          <input 
            type="text" 
            id="search-input"
            placeholder="Employee name, team lead..."
            class="w-full border border-neutral-200 rounded px-3 py-2 text-sm placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2"
          />
        </div>

        <!-- Employee Filter -->
        <div class="mb-4">
          <label class="block text-xs text-secondary mb-1">Employee</label>
          <select id="employee-filter" class="w-full border border-neutral-200 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2">
            <option value="">All Employees</option>
          </select>
        </div>

        <!-- Department Filter -->
        <div class="mb-4">
          <label class="block text-xs text-secondary mb-1">Department</label>
          <select id="department-filter" class="w-full border border-neutral-200 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2">
            <option value="">All Departments</option>
          </select>
        </div>

        <!-- Cycle Filter -->
        <div class="mb-4">
          <label class="block text-xs text-secondary mb-1">Assessment Cycle</label>
          <select id="cycle-filter" class="w-full border border-neutral-200 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2">
            <option value="">All Cycles</option>
          </select>
        </div>

        <!-- Team Lead Filter -->
        <div class="mb-4">
          <label class="block text-xs text-secondary mb-1">Team Lead</label>
          <select id="team-lead-filter" class="w-full border border-neutral-200 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2">
            <option value="">All Team Leads</option>
          </select>
        </div>

        <!-- Status Filter -->
        <div class="mb-4">
          <label class="block text-xs text-secondary mb-1">Status</label>
          <select id="status-filter" class="w-full border border-neutral-200 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2">
            <option value="">All Statuses</option>
            <option value="submitted">Submitted</option>
            <option value="closedDueToReassignment">Closed Due to Reassignment</option>
          </select>
        </div>

        <button id="clear-filters-btn" class="w-full bg-neutral-100 text-secondary border border-neutral-200 rounded-md px-3 py-2 text-sm hover:bg-neutral-200 transition-colors duration-150">
          Clear Filters
        </button>
      </div>
    </aside>

    <!-- Right Pane: Data Grid -->
    <main class="col-span-12 lg:col-span-9">
      <div class="bg-white rounded-md shadow-sm border border-neutral-200">
        <!-- Data Grid Header -->
        <div class="px-4 py-3 border-b border-neutral-200">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
            <h3 class="text-lg font-semibold text-primary">Assessments</h3>
            <div class="flex items-center gap-2 text-sm text-secondary">
              <span id="results-count">0 assessments</span>
            </div>
          </div>
        </div>

        <!-- Loading Skeleton -->
        <div id="assessments-skeleton" class="p-4">
          <div class="space-y-3">
            <div class="animate-pulse flex items-center space-x-4 p-3 border border-neutral-200 rounded">
              <div class="h-4 bg-neutral-200 rounded w-1/4"></div>
              <div class="h-4 bg-neutral-200 rounded w-1/4"></div>
              <div class="h-4 bg-neutral-200 rounded w-1/4"></div>
              <div class="h-4 bg-neutral-200 rounded w-1/4"></div>
            </div>
            <div class="animate-pulse flex items-center space-x-4 p-3 border border-neutral-200 rounded">
              <div class="h-4 bg-neutral-200 rounded w-1/4"></div>
              <div class="h-4 bg-neutral-200 rounded w-1/4"></div>
              <div class="h-4 bg-neutral-200 rounded w-1/4"></div>
              <div class="h-4 bg-neutral-200 rounded w-1/4"></div>
            </div>
            <div class="animate-pulse flex items-center space-x-4 p-3 border border-neutral-200 rounded">
              <div class="h-4 bg-neutral-200 rounded w-1/4"></div>
              <div class="h-4 bg-neutral-200 rounded w-1/4"></div>
              <div class="h-4 bg-neutral-200 rounded w-1/4"></div>
              <div class="h-4 bg-neutral-200 rounded w-1/4"></div>
            </div>
          </div>
        </div>

        <!-- Data Table -->
        <div id="assessments-table-container" class="hidden overflow-x-auto">
          <table class="w-full">
            <thead class="bg-neutral-50 sticky top-0">
              <tr class="text-secondary text-xs">
                <th class="text-left px-4 py-3 border-b border-neutral-200 font-semibold">Employee</th>
                <th class="text-left px-4 py-3 border-b border-neutral-200 font-semibold">Team Lead</th>
                <th class="text-left px-4 py-3 border-b border-neutral-200 font-semibold">Cycle</th>
                <th class="text-left px-4 py-3 border-b border-neutral-200 font-semibold">Submitted</th>
                <th class="text-left px-4 py-3 border-b border-neutral-200 font-semibold">Status</th>
                <th class="text-left px-4 py-3 border-b border-neutral-200 font-semibold">Actions</th>
              </tr>
            </thead>
            <tbody id="assessments-tbody" class="text-sm">
              <!-- Dynamic content -->
            </tbody>
          </table>
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-12">
          <i data-lucide="file-text" class="w-12 h-12 text-neutral-400 mx-auto mb-4"></i>
          <h3 class="text-lg font-semibold text-neutral-700 mb-2">No Assessments Found</h3>
          <p class="text-neutral-500">No assessments match your current filters.</p>
        </div>

        <!-- Pagination -->
        <div id="pagination-container" class="hidden px-4 py-3 border-t border-neutral-200">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <div class="text-sm text-secondary">
              Showing <span id="pagination-start">0</span> to <span id="pagination-end">0</span> of <span id="pagination-total">0</span> results
            </div>
            <div class="flex items-center gap-2">
              <button id="prev-page-btn" class="inline-flex items-center gap-1 px-3 py-1 border border-neutral-200 rounded text-sm text-secondary hover:bg-neutral-50 disabled:opacity-50 disabled:cursor-not-allowed">
                <i data-lucide="chevron-left" class="w-4 h-4"></i>
                Previous
              </button>
              <button id="next-page-btn" class="inline-flex items-center gap-1 px-3 py-1 border border-neutral-200 rounded text-sm text-secondary hover:bg-neutral-50 disabled:opacity-50 disabled:cursor-not-allowed">
                Next
                <i data-lucide="chevron-right" class="w-4 h-4"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Assessment Detail Drawer -->
  <div id="assessment-drawer" class="hidden fixed inset-y-0 right-0 w-full sm:w-2/3 lg:w-1/2 xl:w-2/5 bg-white shadow-lg border-l border-neutral-200 z-40 overflow-y-auto">
    <!-- Drawer Header -->
    <div class="sticky top-0 bg-white border-b border-neutral-200 px-6 py-4">
      <div class="flex items-center justify-between">
        <div>
          <h3 class="text-lg font-semibold text-primary">Assessment Details</h3>
          <p class="text-sm text-secondary" id="drawer-employee-name">Employee Assessment</p>
        </div>
        <div class="flex items-center gap-2">
          <button id="audit-trail-btn" class="inline-flex items-center gap-2 text-sm text-accent hover:text-blue-700 transition-colors duration-150">
            <i data-lucide="file-search" class="w-4 h-4"></i>
            Audit Trail
          </button>
          <button id="close-drawer-btn" class="p-2 hover:bg-neutral-100 rounded-md transition-colors duration-150">
            <i data-lucide="x" class="w-5 h-5 text-secondary"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Drawer Content -->
    <div class="p-6">
      <!-- Assessment Overview -->
      <div class="mb-6">
        <h4 class="text-md font-semibold text-primary mb-3">Assessment Overview</h4>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-xs text-secondary mb-1">Employee</label>
            <p class="text-sm text-neutral-700" id="detail-employee-name">N/A</p>
          </div>
          <div>
            <label class="block text-xs text-secondary mb-1">Team Lead</label>
            <p class="text-sm text-neutral-700" id="detail-team-lead-name">N/A</p>
          </div>
          <div>
            <label class="block text-xs text-secondary mb-1">Assessment Cycle</label>
            <p class="text-sm text-neutral-700" id="detail-cycle-name">N/A</p>
          </div>
          <div>
            <label class="block text-xs text-secondary mb-1">Submitted At</label>
            <p class="text-sm text-neutral-700" id="detail-submitted-at">N/A</p>
          </div>
          <div>
            <label class="block text-xs text-secondary mb-1">Type</label>
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs" id="detail-type-badge">N/A</span>
          </div>
          <div>
            <label class="block text-xs text-secondary mb-1">Status</label>
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs" id="detail-status-badge">N/A</span>
          </div>
        </div>
      </div>

      <!-- Assessment Items -->
      <div>
        <h4 class="text-md font-semibold text-primary mb-3">Assessment Items</h4>
        
        <!-- Loading Skeleton for Items -->
        <div id="items-skeleton" class="space-y-4">
          <div class="animate-pulse">
            <div class="h-4 bg-neutral-200 rounded w-3/4 mb-2"></div>
            <div class="h-3 bg-neutral-100 rounded w-1/2"></div>
          </div>
          <div class="animate-pulse">
            <div class="h-4 bg-neutral-200 rounded w-3/4 mb-2"></div>
            <div class="h-3 bg-neutral-100 rounded w-1/2"></div>
          </div>
        </div>

        <!-- Assessment Items List -->
        <div id="assessment-items-container">
          <!-- Dynamic content -->
        </div>
      </div>
    </div>
  </div>

  <!-- Drawer Backdrop -->
  <div id="drawer-backdrop" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-30"></div>
</div>

        </main>
    </div>

    <!-- Required: JavaScript -->
    <script type="module" data-tiramai="web-gen">
        import { showToast, showLoader, hideLoader, env } from "./scripts/main.js";
        import { auth, db, storage } from "./scripts/firebase.js";
        import { onAuthStateChanged, getAuth, signOut } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js';
        import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js';

        // Initialize Lucide icons
        lucide.createIcons();

        // Auth state management
        let currentUser = null;

        // Initialize auth state listener
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                await loadUserProfile(user);
            } else {
                // Redirect to auth page if not authenticated
                window.location.href = 'auth.html';
            }
        });

        // Load user profile data
        async function loadUserProfile(user) {
            try {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    const fullName = `${userData.firstName || ''} ${userData.lastName || ''}`.trim();
                    document.getElementById('user-name').textContent = fullName || user.email;
                } else {
                    // Fallback to email if no user doc exists
                    document.getElementById('user-name').textContent = user.email;
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
                // Fallback to email on error
                document.getElementById('user-name').textContent = user.email;
            }
        }

        // User dropdown functionality
        const userProfileBtn = document.getElementById('user-profile-btn');
        const userDropdown = document.getElementById('user-dropdown');
        const signOutBtn = document.getElementById('sign-out-btn');

        userProfileBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            userDropdown.classList.toggle('hidden');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', () => {
            userDropdown.classList.add('hidden');
        });

        // Sign out functionality
        signOutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                window.location.href = 'auth.html';
            } catch (error) {
                console.error('Error signing out:', error);
                showToast('Error signing out', 'error');
            }
        });

        // Mobile navigation
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileNavOverlay = document.getElementById('mobile-nav-overlay');
        const mobileNavBackdrop = document.getElementById('mobile-nav-backdrop');

        mobileMenuBtn.addEventListener('click', () => {
            mobileNavOverlay.classList.remove('hidden');
        });

        mobileNavBackdrop.addEventListener('click', () => {
            mobileNavOverlay.classList.add('hidden');
        });

        // Close mobile nav on navigation
        document.querySelectorAll('#mobile-nav-overlay .nav-item').forEach(link => {
            link.addEventListener('click', () => {
                mobileNavOverlay.classList.add('hidden');
            });
        });

        // Active navigation state
        function updateActiveNavState() {
            const currentPath = window.location.pathname;
            const pageName = currentPath.replace('/', '').replace('.html', '');
            
            // Remove active state from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-accent', 'text-white');
                item.classList.add('text-neutral-700');
            });

            // Add active state to current page
            document.querySelectorAll(`[data-page="${pageName}"]`).forEach(item => {
                item.classList.add('bg-accent', 'text-white');
                item.classList.remove('text-neutral-700');
            });
        }

        // Update active state on load
        updateActiveNavState();

        // Update active state on navigation (for SPA behavior)
        window.addEventListener('popstate', updateActiveNavState);
    </script>

    
<script id="data-script" type="module" data-tiramai="web-gen">
// Firebase imports
import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js';
import { 
  collection, getDocs, query, where, orderBy, limit, startAfter,
  doc, getDoc, Timestamp
} from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js';
import { auth, getDb } from "./scripts/firebase.js";
import { showToast, showLoader, hideLoader, env } from "./scripts/main.js";

const db = getDb();

// State management
let currentUser = null;
let assessments = [];
let filteredAssessments = [];
let employees = new Map();
let departments = new Map();
let cycles = new Map();
let skills = new Map();
let currentPage = 1;
let pageSize = 10;
let totalCount = 0;
let currentAssessmentId = null;
let isDisputed = false;

// URL params
const urlParams = new URLSearchParams(window.location.search);
const assessmentId = urlParams.get('assessmentId');
const employeeId = urlParams.get('employeeId');
const cycleId = urlParams.get('cycleId');
const source = urlParams.get('source');
const returnTo = urlParams.get('returnTo');

// Auth check
onAuthStateChanged(auth, user => {
  if (!user) {
    location.href = "auth.html?redirect=" + encodeURIComponent(location.pathname);
  } else {
    currentUser = user;
    funInitialLoad();
  }
});

// Initialize page
async function funInitialLoad() {
  try {
    // Set dispute mode if source is dispute
    if (source === 'dispute') {
      isDisputed = true;
    }

    // Load initial data concurrently (max 2 at a time)
    await Promise.all([
      funLoadEmployees(),
      funLoadDepartments()
    ]);
    
    await Promise.all([
      funLoadCycles(),
      funLoadSkills()
    ]);

    // Apply initial filters if params exist
    if (employeeId) {
      document.getElementById('employee-filter').value = employeeId;
    }
    if (cycleId) {
      document.getElementById('cycle-filter').value = cycleId;
    }

    // Load assessments
    await funLoadAssessments();

    // If specific assessment ID provided, open it
    if (assessmentId) {
      setTimeout(() => funOpenAssessmentDrawer(assessmentId), 500);
    }

    // Initialize event listeners
    funInitializeEventListeners();

    lucide.createIcons();
  } catch (error) {
    console.error('Error loading page:', error);
    showToast('Failed to load page data', 'error');
  }
}

// Load employees
async function funLoadEmployees() {
  try {
    const q = query(
      collection(db, 'employees'),
      where('status', '==', 'active'),
      orderBy('name')
    );
    const snapshot = await getDocs(q);
    
    employees.clear();
    const select = document.getElementById('employee-filter');
    select.innerHTML = '<option value="">All Employees</option>';

    snapshot.docs.forEach(doc => {
      const emp = { id: doc.id, ...doc.data() };
      employees.set(emp.id, emp);
      
      const option = document.createElement('option');
      option.value = emp.id;
      option.textContent = emp.name || 'N/A';
      select.appendChild(option);
    });
  } catch (error) {
    console.error('Error loading employees:', error);
    showToast('Failed to load employees', 'error');
  }
}

// Load departments
async function funLoadDepartments() {
  try {
    const q = query(
      collection(db, 'departments'),
      where('status', '==', 'active'),
      orderBy('name')
    );
    const snapshot = await getDocs(q);
    
    departments.clear();
    const select = document.getElementById('department-filter');
    select.innerHTML = '<option value="">All Departments</option>';

    snapshot.docs.forEach(doc => {
      const dept = { id: doc.id, ...doc.data() };
      departments.set(dept.id, dept);
      
      const option = document.createElement('option');
      option.value = dept.id;
      option.textContent = dept.name || 'N/A';
      select.appendChild(option);
    });
  } catch (error) {
    console.error('Error loading departments:', error);
    showToast('Failed to load departments', 'error');
  }
}

// Load cycles
async function funLoadCycles() {
  try {
    const q = query(
      collection(db, 'assessmentCycles'),
      where('status', '==', 'active'),
      orderBy('startDate', 'desc')
    );
    const snapshot = await getDocs(q);
    
    cycles.clear();
    const select = document.getElementById('cycle-filter');
    select.innerHTML = '<option value="">All Cycles</option>';

    snapshot.docs.forEach(doc => {
      const cycle = { id: doc.id, ...doc.data() };
      cycles.set(cycle.id, cycle);
      
      const option = document.createElement('option');
      option.value = cycle.id;
      option.textContent = cycle.name || 'N/A';
      select.appendChild(option);
    });

    // Populate team lead filter from loaded employees
    funPopulateTeamLeadFilter();
  } catch (error) {
    console.error('Error loading cycles:', error);
    showToast('Failed to load cycles', 'error');
  }
}

// Load skills
async function funLoadSkills() {
  try {
    const q = query(
      collection(db, 'skills'),
      where('status', '==', 'active')
    );
    const snapshot = await getDocs(q);
    
    skills.clear();
    snapshot.docs.forEach(doc => {
      const skill = { id: doc.id, ...doc.data() };
      skills.set(skill.id, skill);
    });
  } catch (error) {
    console.error('Error loading skills:', error);
    showToast('Failed to load skills', 'error');
  }
}

// Populate team lead filter
function funPopulateTeamLeadFilter() {
  const select = document.getElementById('team-lead-filter');
  select.innerHTML = '<option value="">All Team Leads</option>';

  // Get unique team leads from employees
  const teamLeads = new Set();
  employees.forEach(emp => {
    if (emp.id) {
      teamLeads.add(emp.id);
    }
  });

  teamLeads.forEach(teamLeadId => {
    const emp = employees.get(teamLeadId);
    if (emp) {
      const option = document.createElement('option');
      option.value = emp.id;
      option.textContent = emp.name || 'N/A';
      select.appendChild(option);
    }
  });
}

// Load assessments with server-side filtering
async function funLoadAssessments(loadMore = false) {
  try {
    if (!loadMore) {
      document.getElementById('assessments-skeleton').classList.remove('hidden');
      document.getElementById('assessments-table-container').classList.add('hidden');
      document.getElementById('empty-state').classList.add('hidden');
    }

    // Build query with filters
    let constraints = [where('status', 'in', ['submitted', 'closedDueToReassignment'])];

    // Apply filters
    const selectedEmployee = document.getElementById('employee-filter').value;
    const selectedDepartment = document.getElementById('department-filter').value;
    const selectedCycle = document.getElementById('cycle-filter').value;
    const selectedTeamLead = document.getElementById('team-lead-filter').value;
    const selectedStatus = document.getElementById('status-filter').value;

    if (selectedEmployee) {
      constraints.push(where('employeeId', '==', selectedEmployee));
    }
    if (selectedCycle) {
      constraints.push(where('cycleId', '==', selectedCycle));
    }
    if (selectedTeamLead) {
      constraints.push(where('teamLeadId', '==', selectedTeamLead));
    }
    if (selectedStatus) {
      constraints.push(where('status', '==', selectedStatus));
    }

    // Add ordering and limit
    constraints.push(orderBy('submittedAt', 'desc'));
    constraints.push(limit(pageSize));

    const q = query(collection(db, 'assessments'), ...constraints);
    const snapshot = await getDocs(q);

    if (!loadMore) {
      assessments = [];
    }

    // Process documents
    snapshot.docs.forEach(doc => {
      const assessment = { id: doc.id, ...doc.data() };
      
      // Apply department filter client-side if needed
      if (selectedDepartment) {
        const employee = employees.get(assessment.employeeId);
        if (!employee || employee.departmentId !== selectedDepartment) {
          return;
        }
      }
      
      assessments.push(assessment);
    });

    await funApplySearchFilter();
    funRenderAssessmentsTable();

    document.getElementById('assessments-skeleton').classList.add('hidden');
  } catch (error) {
    console.error('Error loading assessments:', error);
    showToast('Failed to load assessments', 'error');
    document.getElementById('assessments-skeleton').classList.add('hidden');
    document.getElementById('empty-state').classList.remove('hidden');
  }
}

// Apply search filter
async function funApplySearchFilter() {
  const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
  
  if (!searchTerm) {
    filteredAssessments = [...assessments];
  } else {
    filteredAssessments = assessments.filter(assessment => {
      const employee = employees.get(assessment.employeeId);
      const teamLead = employees.get(assessment.teamLeadId);
      const cycle = cycles.get(assessment.cycleId);
      
      const employeeName = employee?.name?.toLowerCase() || '';
      const teamLeadName = teamLead?.name?.toLowerCase() || '';
      const cycleName = cycle?.name?.toLowerCase() || '';
      
      return employeeName.includes(searchTerm) || 
             teamLeadName.includes(searchTerm) || 
             cycleName.includes(searchTerm);
    });
  }
}

// Render assessments table
function funRenderAssessmentsTable() {
  const tbody = document.getElementById('assessments-tbody');
  const tableContainer = document.getElementById('assessments-table-container');
  const emptyState = document.getElementById('empty-state');
  const resultsCount = document.getElementById('results-count');

  tbody.innerHTML = '';

  if (filteredAssessments.length === 0) {
    tableContainer.classList.add('hidden');
    emptyState.classList.remove('hidden');
    resultsCount.textContent = '0 assessments';
    return;
  }

  tableContainer.classList.remove('hidden');
  emptyState.classList.add('hidden');
  resultsCount.textContent = `${filteredAssessments.length} assessment${filteredAssessments.length !== 1 ? 's' : ''}`;

  filteredAssessments.forEach(assessment => {
    const row = document.createElement('tr');
    row.className = 'hover:bg-neutral-50 cursor-pointer transition-colors duration-150';
    row.setAttribute('data-assessment-id', assessment.id);

    const employee = employees.get(assessment.employeeId);
    const teamLead = employees.get(assessment.teamLeadId);
    const cycle = cycles.get(assessment.cycleId);

    const submittedAt = assessment.submittedAt ? 
      new Date(assessment.submittedAt).toLocaleDateString('en-IN', {
        day: '2-digit',
        month: '2-digit', 
        year: 'numeric'
      }) : 'N/A';

    const statusBadge = funGetStatusBadge(assessment.status || 'submitted');
    
    row.innerHTML = `
      <td class="px-4 py-3 text-neutral-700">${employee?.name || 'N/A'}</td>
      <td class="px-4 py-3 text-neutral-700">${teamLead?.name || 'N/A'}</td>
      <td class="px-4 py-3 text-neutral-700">${cycle?.name || 'N/A'}</td>
      <td class="px-4 py-3 text-neutral-700">${submittedAt}</td>
      <td class="px-4 py-3">${statusBadge}</td>
      <td class="px-4 py-3">
        <button class="inline-flex items-center gap-1 text-sm text-accent hover:text-blue-700 transition-colors duration-150" 
                onclick="funOpenAssessmentDrawer('${assessment.id}')">
          <i data-lucide="eye" class="w-4 h-4"></i>
          View
        </button>
      </td>
    `;

    // Add click listener to row
    row.addEventListener('click', () => funOpenAssessmentDrawer(assessment.id));
    
    tbody.appendChild(row);
  });

  lucide.createIcons();
}

// Get status badge HTML
function funGetStatusBadge(status) {
  const badges = {
    submitted: 'bg-success text-white',
    closedDueToReassignment: 'bg-neutral-400 text-white'
  };

  const labels = {
    submitted: 'Submitted',
    closedDueToReassignment: 'Closed Due to Reassignment'
  };

  const badgeClass = badges[status] || 'bg-neutral-400 text-white';
  const label = labels[status] || status;

  return `<span class="inline-flex items-center px-2 py-1 rounded-full text-xs ${badgeClass}">${label}</span>`;
}

// Open assessment drawer
async function funOpenAssessmentDrawer(assessmentId) {
  try {
    showLoader();
    currentAssessmentId = assessmentId;

    // Get assessment details
    const assessmentDoc = await getDoc(doc(db, 'assessments', assessmentId));
    if (!assessmentDoc.exists()) {
      throw new Error('Assessment not found');
    }

    const assessment = { id: assessmentDoc.id, ...assessmentDoc.data() };
    
    // Load assessment items and render drawer
    await funRenderAssessmentDrawer(assessment);
    
    // Show drawer
    document.getElementById('assessment-drawer').classList.remove('hidden');
    document.getElementById('drawer-backdrop').classList.remove('hidden');
    document.body.style.overflow = 'hidden';

    hideLoader();
  } catch (error) {
    console.error('Error opening assessment drawer:', error);
    showToast('Failed to load assessment details', 'error');
    hideLoader();
  }
}

// Render assessment drawer
async function funRenderAssessmentDrawer(assessment) {
  const employee = employees.get(assessment.employeeId);
  const teamLead = employees.get(assessment.teamLeadId);
  const cycle = cycles.get(assessment.cycleId);

  // Update header
  document.getElementById('drawer-employee-name').textContent = 
    `${employee?.name || 'N/A'} Assessment`;

  // Update overview
  document.getElementById('detail-employee-name').textContent = employee?.name || 'N/A';
  document.getElementById('detail-team-lead-name').textContent = teamLead?.name || 'N/A';
  document.getElementById('detail-cycle-name').textContent = cycle?.name || 'N/A';
  
  const submittedAt = assessment.submittedAt ? 
    new Date(assessment.submittedAt).toLocaleDateString('en-IN', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    }) : 'N/A';
  document.getElementById('detail-submitted-at').textContent = submittedAt;

  // Type badge
  const typeBadge = document.getElementById('detail-type-badge');
  typeBadge.textContent = assessment.type === 'reassessment' ? 'Reassessment' : 'Initial';
  typeBadge.className = `inline-flex items-center px-2 py-1 rounded-full text-xs ${
    assessment.type === 'reassessment' ? 'bg-info text-white' : 'bg-accent text-white'
  }`;

  // Status badge
  const statusBadge = document.getElementById('detail-status-badge');
  const statusClass = assessment.status === 'submitted' ? 'bg-success text-white' : 'bg-neutral-400 text-white';
  const statusLabel = assessment.status === 'submitted' ? 'Submitted' : 'Closed Due to Reassignment';
  statusBadge.className = `inline-flex items-center px-2 py-1 rounded-full text-xs ${statusClass}`;
  statusBadge.textContent = statusLabel;

  // Render assessment items
  await funRenderAssessmentItems(assessment.items || []);
}

// Render assessment items
async function funRenderAssessmentItems(items) {
  const container = document.getElementById('assessment-items-container');
  const skeleton = document.getElementById('items-skeleton');
  
  skeleton.classList.add('hidden');
  container.innerHTML = '';

  if (!items || items.length === 0) {
    container.innerHTML = `
      <div class="text-center py-8">
        <i data-lucide="clipboard-list" class="w-8 h-8 text-neutral-400 mx-auto mb-3"></i>
        <p class="text-neutral-500">No assessment items found.</p>
      </div>
    `;
    lucide.createIcons();
    return;
  }

  // Sort items by skill name if skills are loaded
  const sortedItems = items.sort((a, b) => {
    const skillA = skills.get(a.skillId);
    const skillB = skills.get(b.skillId);
    return (skillA?.name || '').localeCompare(skillB?.name || '');
  });

  sortedItems.forEach(item => {
    const skill = skills.get(item.skillId);
    const gap = (item.benchmarkAtAssessment || 0) - (item.score || 0);
    const tni = gap > 0 ? funCalculateTNI(gap, item.criticalityWeight || 1) : 'None';

    const itemElement = document.createElement('div');
    itemElement.className = 'border border-neutral-200 rounded-md p-4 mb-4';

    // Dispute highlighting for dispute source
    if (isDisputed && item.disputeAnnotation) {
      itemElement.classList.add('border-warning', 'bg-yellow-50');
    }

    itemElement.innerHTML = `
      <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
        <div class="flex-1">
          <h5 class="font-semibold text-primary mb-2">${skill?.name || 'Unknown Skill'}</h5>
          
          <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-3">
            <div>
              <label class="block text-xs text-secondary mb-1">Score</label>
              <div class="flex items-center gap-2">
                <span class="text-lg font-semibold text-primary">${item.score || 0}</span>
                <span class="text-xs text-neutral-400">/ 10</span>
              </div>
            </div>
            <div>
              <label class="block text-xs text-secondary mb-1">Benchmark</label>
              <div class="flex items-center gap-2">
                <span class="text-lg font-semibold text-secondary">${item.benchmarkAtAssessment || 0}</span>
                <span class="text-xs text-neutral-400">/ 10</span>
              </div>
            </div>
            <div>
              <label class="block text-xs text-secondary mb-1">Gap</label>
              <div class="flex items-center gap-2">
                <span class="text-lg font-semibold ${gap > 0 ? 'text-error' : 'text-success'}">${gap}</span>
                ${gap > 0 ? '<i data-lucide="arrow-down" class="w-4 h-4 text-error"></i>' : '<i data-lucide="check" class="w-4 h-4 text-success"></i>'}
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-3">
            <div>
              <label class="block text-xs text-secondary mb-1">Training Need Intensity</label>
              <span class="inline-flex items-center px-2 py-1 rounded-full text-xs ${funGetTNIBadgeClass(tni)}">
                ${tni}
              </span>
            </div>
            <div>
              <label class="block text-xs text-secondary mb-1">Weighted Gap</label>
              <span class="text-sm text-neutral-700">${item.weightedGap || 0}</span>
            </div>
          </div>

          ${item.comment ? `
            <div>
              <label class="block text-xs text-secondary mb-1">Comment</label>
              <p class="text-sm text-neutral-700 bg-neutral-50 p-3 rounded border">${item.comment}</p>
            </div>
          ` : ''}

          ${isDisputed && item.disputeAnnotation ? `
            <div class="mt-3 p-3 bg-warning-50 border border-warning rounded">
              <label class="block text-xs text-warning font-semibold mb-1">Dispute Annotation</label>
              <p class="text-sm text-warning-800">${item.disputeAnnotation}</p>
            </div>
          ` : ''}
        </div>
      </div>
    `;

    container.appendChild(itemElement);
  });

  lucide.createIcons();
}

// Calculate TNI
function funCalculateTNI(gap, criticalityWeight) {
  const weightedGap = gap * (criticalityWeight || 1);
  if (weightedGap >= 3) return 'Red';
  if (weightedGap >= 1.5) return 'Amber';
  return 'Green';
}

// Get TNI badge class
function funGetTNIBadgeClass(tni) {
  const classes = {
    'Red': 'bg-error text-white',
    'Amber': 'bg-warning text-white',
    'Green': 'bg-success text-white',
    'None': 'bg-neutral-200 text-neutral-700'
  };
  return classes[tni] || 'bg-neutral-200 text-neutral-700';
}

// Close drawer
function funCloseDrawer() {
  document.getElementById('assessment-drawer').classList.add('hidden');
  document.getElementById('drawer-backdrop').classList.add('hidden');
  document.body.style.overflow = '';
  currentAssessmentId = null;
}

// Navigate to audit trail
function funNavigateToAuditTrail() {
  if (!currentAssessmentId) return;
  
  const params = new URLSearchParams({
    entityType: 'assessment',
    entityId: currentAssessmentId,
    returnTo: 'assessment_viewer'
  });
  
  window.location.href = `audit_log_viewer.html?${params.toString()}`;
}

// Navigate back
function funNavigateBack() {
  if (returnTo) {
    window.location.href = `${returnTo}.html`;
  } else {
    window.location.href = 'analytics_hub.html';
  }
}

// Clear filters
function funClearFilters() {
  document.getElementById('search-input').value = '';
  document.getElementById('employee-filter').value = '';
  document.getElementById('department-filter').value = '';
  document.getElementById('cycle-filter').value = '';
  document.getElementById('team-lead-filter').value = '';
  document.getElementById('status-filter').value = '';
  
  currentPage = 1;
  funLoadAssessments();
}

// Initialize event listeners
function funInitializeEventListeners() {
  // Search with debounce
  let searchTimeout;
  document.getElementById('search-input').addEventListener('input', () => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      funApplySearchFilter().then(() => funRenderAssessmentsTable());
    }, 300);
  });

  // Filter changes
  ['employee-filter', 'department-filter', 'cycle-filter', 'team-lead-filter', 'status-filter'].forEach(id => {
    document.getElementById(id).addEventListener('change', () => {
      currentPage = 1;
      funLoadAssessments();
    });
  });

  // Buttons
  document.getElementById('btn-refresh').addEventListener('click', () => funLoadAssessments());
  document.getElementById('btn-back').addEventListener('click', funNavigateBack);
  document.getElementById('clear-filters-btn').addEventListener('click', funClearFilters);
  
  // Drawer controls
  document.getElementById('close-drawer-btn').addEventListener('click', funCloseDrawer);
  document.getElementById('drawer-backdrop').addEventListener('click', funCloseDrawer);
  document.getElementById('audit-trail-btn').addEventListener('click', funNavigateToAuditTrail);

  // ESC key to close drawer
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !document.getElementById('assessment-drawer').classList.contains('hidden')) {
      funCloseDrawer();
    }
  });
}

// Global function for row clicks
window.funOpenAssessmentDrawer = funOpenAssessmentDrawer;
</script>

</body>
</html>